#include <stdlib.h>
#include <time.h>
#include "block.h"
#include "stage.h"

struct Block b;
struct Block nb; // next block
struct BlockPattern bp[7];

#define INIT_M 0
#define INIT_X 3

int genRandomPattern()
{
	return rand() % 7;
}

void initBlock()
{
  b.pattern = genRandomPattern();
  b.mode = 0;
  b.rpx  = 4;
  b.rpy = H - bp[b.pattern].max_y;
  genNextBlock();
}

void genNextBlock()
{
	nb.pattern = genRandomPattern();
	nb.mode = INIT_M;
	nb.rpx = 0;
	nb.rpy = 0;
}

void updateBlock()
{
	b.pattern = nb.pattern;
	b.mode = INIT_M;
	b.rpx = INIT_X;
	b.rpy = H - bp[b.pattern].max_y; // [‰Û‘è03]
	genNextBlock();
}

void initBlockPattern()
{
  // QÆ
  // http://www.ongame-tetris.net/tetris_kaiten.html

  // stick
  bp[0].rgb[0] = 1.0;
  bp[0].rgb[1] = 0.0;
  bp[0].rgb[2] = 0.0;
  bp[0].max_y = 4;

  bp[0].x[0][0] = 2;  bp[0].y[0][0] = 1;
  bp[0].x[0][1] = 2;  bp[0].y[0][1] = 2;
  bp[0].x[0][2] = 2;  bp[0].y[0][2] = 3;
  bp[0].x[0][3] = 2;  bp[0].y[0][3] = 4;

  bp[0].x[1][0] = 0;  bp[0].y[1][0] = 2;
  bp[0].x[1][1] = 1;  bp[0].y[1][1] = 2;
  bp[0].x[1][2] = 2;  bp[0].y[1][2] = 2;
  bp[0].x[1][3] = 3;  bp[0].y[1][3] = 2;

  bp[0].x[2][0] = 2;  bp[0].y[2][0] = 0;
  bp[0].x[2][1] = 2;  bp[0].y[2][1] = 1;
  bp[0].x[2][2] = 2;  bp[0].y[2][2] = 2;
  bp[0].x[2][3] = 2;  bp[0].y[2][3] = 3;

  bp[0].x[3][0] = 1;  bp[0].y[3][0] = 2;
  bp[0].x[3][1] = 2;  bp[0].y[3][1] = 2;
  bp[0].x[3][2] = 3;  bp[0].y[3][2] = 2;
  bp[0].x[3][3] = 4;  bp[0].y[3][3] = 2;

  // L
  bp[1].rgb[0] = 1.0;
  bp[1].rgb[1] = 1.0;
  bp[1].rgb[2] = 0.0;
  bp[1].max_y = 3;

  bp[1].x[0][0] = 2;  bp[1].y[0][0] = 3;
  bp[1].x[0][1] = 2;  bp[1].y[0][1] = 2;
  bp[1].x[0][2] = 2;  bp[1].y[0][2] = 1;
  bp[1].x[0][3] = 3;  bp[1].y[0][3] = 1;

  bp[1].x[1][0] = 1;  bp[1].y[1][0] = 2;
  bp[1].x[1][1] = 2;  bp[1].y[1][1] = 2;
  bp[1].x[1][2] = 3;  bp[1].y[1][2] = 2;
  bp[1].x[1][3] = 3;  bp[1].y[1][3] = 3;

  bp[1].x[2][0] = 1;  bp[1].y[2][0] = 3;
  bp[1].x[2][1] = 2;  bp[1].y[2][1] = 3;
  bp[1].x[2][2] = 2;  bp[1].y[2][2] = 2;
  bp[1].x[2][3] = 2;  bp[1].y[2][3] = 1;

  bp[1].x[3][0] = 1;  bp[1].y[3][0] = 1;
  bp[1].x[3][1] = 1;  bp[1].y[3][1] = 2;
  bp[1].x[3][2] = 2;  bp[1].y[3][2] = 2;
  bp[1].x[3][3] = 3;  bp[1].y[3][3] = 2;

  // reverse L
  bp[2].rgb[0] = 1.0;
  bp[2].rgb[1] = 0.0;
  bp[2].rgb[2] = 0.5;
  bp[2].max_y = 3;

  bp[2].x[0][0] = 1;  bp[2].y[0][0] = 1;
  bp[2].x[0][1] = 2;  bp[2].y[0][1] = 1;
  bp[2].x[0][2] = 2;  bp[2].y[0][2] = 2;
  bp[2].x[0][3] = 2;  bp[2].y[0][3] = 3;

  bp[2].x[1][0] = 1;  bp[2].y[1][0] = 2;
  bp[2].x[1][1] = 2;  bp[2].y[1][1] = 2;
  bp[2].x[1][2] = 3;  bp[2].y[1][2] = 2;
  bp[2].x[1][3] = 3;  bp[2].y[1][3] = 1;

  bp[2].x[2][0] = 2;  bp[2].y[2][0] = 1;
  bp[2].x[2][1] = 2;  bp[2].y[2][1] = 2;
  bp[2].x[2][2] = 2;  bp[2].y[2][2] = 3;
  bp[2].x[2][3] = 3;  bp[2].y[2][3] = 3;

  bp[2].x[3][0] = 1;  bp[2].y[3][0] = 3;
  bp[2].x[3][1] = 1;  bp[2].y[3][1] = 2;
  bp[2].x[3][2] = 2;  bp[2].y[3][2] = 2;
  bp[2].x[3][3] = 3;  bp[2].y[3][3] = 2;

  // Z
  bp[3].rgb[0] = 1.0;
  bp[3].rgb[1] = 0.0;
  bp[3].rgb[2] = 1.0;
  bp[3].max_y = 3;

  bp[3].x[0][0] = 1;  bp[3].y[0][0] = 3;
  bp[3].x[0][1] = 2;  bp[3].y[0][1] = 3;
  bp[3].x[0][2] = 2;  bp[3].y[0][2] = 2;
  bp[3].x[0][3] = 3;  bp[3].y[0][3] = 2;

  bp[3].x[1][0] = 1;  bp[3].y[1][0] = 1;
  bp[3].x[1][1] = 1;  bp[3].y[1][1] = 2;
  bp[3].x[1][2] = 2;  bp[3].y[1][2] = 2;
  bp[3].x[1][3] = 2;  bp[3].y[1][3] = 3;

  bp[3].x[2][0] = 1;  bp[3].y[2][0] = 2;
  bp[3].x[2][1] = 2;  bp[3].y[2][1] = 2;
  bp[3].x[2][2] = 2;  bp[3].y[2][2] = 1;
  bp[3].x[2][3] = 3;  bp[3].y[2][3] = 1;

  bp[3].x[3][0] = 2;  bp[3].y[3][0] = 1;
  bp[3].x[3][1] = 2;  bp[3].y[3][1] = 2;
  bp[3].x[3][2] = 3;  bp[3].y[3][2] = 2;
  bp[3].x[3][3] = 3;  bp[3].y[3][3] = 3;

  // reverse Z
  bp[4].rgb[0] = 0.0;
  bp[4].rgb[1] = 1.0;
  bp[4].rgb[2] = 1.0;
  bp[4].max_y = 3;

  bp[4].x[0][0] = 1;  bp[4].y[0][0] = 2;
  bp[4].x[0][1] = 2;  bp[4].y[0][1] = 2;
  bp[4].x[0][2] = 2;  bp[4].y[0][2] = 3;
  bp[4].x[0][3] = 3;  bp[4].y[0][3] = 3;

  bp[4].x[1][0] = 1;  bp[4].y[1][0] = 3;
  bp[4].x[1][1] = 1;  bp[4].y[1][1] = 2;
  bp[4].x[1][2] = 2;  bp[4].y[1][2] = 2;
  bp[4].x[1][3] = 2;  bp[4].y[1][3] = 1;

  bp[4].x[2][0] = 1;  bp[4].y[2][0] = 1;
  bp[4].x[2][1] = 2;  bp[4].y[2][1] = 1;
  bp[4].x[2][2] = 2;  bp[4].y[2][2] = 2;
  bp[4].x[2][3] = 3;  bp[4].y[2][3] = 2;

  bp[4].x[3][0] = 2;  bp[4].y[3][0] = 3;
  bp[4].x[3][1] = 2;  bp[4].y[3][1] = 2;
  bp[4].x[3][2] = 3;  bp[4].y[3][2] = 2;
  bp[4].x[3][3] = 3;  bp[4].y[3][3] = 1;

  // “Ê
  bp[5].rgb[0] = 0.0;
  bp[5].rgb[1] = 1.0;
  bp[5].rgb[2] = 0.0;
  bp[5].max_y = 3;

  bp[5].x[0][0] = 1;  bp[5].y[0][0] = 2;
  bp[5].x[0][1] = 2;  bp[5].y[0][1] = 2;
  bp[5].x[0][2] = 2;  bp[5].y[0][2] = 3;
  bp[5].x[0][3] = 3;  bp[5].y[0][3] = 2;

  bp[5].x[1][0] = 1;  bp[5].y[1][0] = 2;
  bp[5].x[1][1] = 2;  bp[5].y[1][1] = 1;
  bp[5].x[1][2] = 2;  bp[5].y[1][2] = 2;
  bp[5].x[1][3] = 2;  bp[5].y[1][3] = 3;

  bp[5].x[2][0] = 1;  bp[5].y[2][0] = 2;
  bp[5].x[2][1] = 2;  bp[5].y[2][1] = 2;
  bp[5].x[2][2] = 3;  bp[5].y[2][2] = 2;
  bp[5].x[2][3] = 2;  bp[5].y[2][3] = 1;

  bp[5].x[3][0] = 2;  bp[5].y[3][0] = 1;
  bp[5].x[3][1] = 2;  bp[5].y[3][1] = 2;
  bp[5].x[3][2] = 2;  bp[5].y[3][2] = 3;
  bp[5].x[3][3] = 3;  bp[5].y[3][3] = 2;

  // “c
  bp[6].rgb[0] = 0.0;
  bp[6].rgb[1] = 0.0;
  bp[6].rgb[2] = 1.0;
  bp[6].max_y = 3;

  bp[6].x[0][0] = 1;  bp[6].y[0][0] = 2;
  bp[6].x[0][1] = 1;  bp[6].y[0][1] = 3;
  bp[6].x[0][2] = 2;  bp[6].y[0][2] = 2;
  bp[6].x[0][3] = 2;  bp[6].y[0][3] = 3;

  bp[6].x[1][0] = 1;  bp[6].y[1][0] = 2;
  bp[6].x[1][1] = 1;  bp[6].y[1][1] = 3;
  bp[6].x[1][2] = 2;  bp[6].y[1][2] = 2;
  bp[6].x[1][3] = 2;  bp[6].y[1][3] = 3;

  bp[6].x[2][0] = 1;  bp[6].y[2][0] = 2;
  bp[6].x[2][1] = 1;  bp[6].y[2][1] = 3;
  bp[6].x[2][2] = 2;  bp[6].y[2][2] = 2;
  bp[6].x[2][3] = 2;  bp[6].y[2][3] = 3;

  bp[6].x[3][0] = 1;  bp[6].y[3][0] = 2;
  bp[6].x[3][1] = 1;  bp[6].y[3][1] = 3;
  bp[6].x[3][2] = 2;  bp[6].y[3][2] = 2;
  bp[6].x[3][3] = 2;  bp[6].y[3][3] = 3;

}

///// End of file /////
